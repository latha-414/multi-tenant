trigger:
- main

pool:
  name: Default 

variables:
  azureSubscription: 'AzureServiceConnection'
  nodeVersion: '18.x'

stages:
- stage: DeployTenantA
  jobs:
  - job: DeployA
    steps:
    - checkout: self                 # <-- Important: Fetch repo
    - task: NodeTool@0
      inputs:
        versionSpec: '$(nodeVersion)'
    - script: |
        cd $(System.DefaultWorkingDirectory)
        npm install
      displayName: 'Install npm packages'
    - task: AzureWebApp@1
      inputs:
        azureSubscription: '$(azureSubscription)'
        appName: 'tenant-a-app'
        package: '$(System.DefaultWorkingDirectory)'

- stage: DeployTenantB
  jobs:
  - job: DeployB
    steps:
    - checkout: self
    - task: NodeTool@0
      inputs:
        versionSpec: '$(nodeVersion)'
    - script: |
        cd $(System.DefaultWorkingDirectory)
        npm install
      displayName: 'Install npm packages'
    - task: AzureWebApp@1
      inputs:
        azureSubscription: '$(azureSubscription)'
        appName: 'tenant-b-app'
        package: '$(System.DefaultWorkingDirectory)'

- stage: DeployTenantC
  jobs:
  - job: DeployC
    steps:
    - checkout: self
    - task: NodeTool@0
      inputs:
        versionSpec: '$(nodeVersion)'
    - script: |
        cd $(System.DefaultWorkingDirectory)
        npm install
      displayName: 'Install npm packages'
    - task: AzureWebApp@1
      inputs:
        azureSubscription: '$(azureSubscription)'
        appName: 'tenant-c-app'
        package: '$(System.DefaultWorkingDirectory)'
